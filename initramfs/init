#!/bin/sh

KERNEL="kernel_2712.img"
INITRD="flatcar_production_pxe_image.cpio.gz"

# Mount filesystems
mount -t proc none /proc
mount -t sysfs none /sys
mount -t devtmpfs none /dev

# Setup dhcp
ip link set eth0 up
udhcpc

# Download and unpack image
cd /mnt/
curl -O -k https://syno.lan:8443/${KERNEL}
curl -O -k https://syno.lan:8443/${INITRD}
kexec -l ${KERNEL} --initrd=${INITRD} --append="$(cat /proc/cmdline)"

clear

# Boot the real thing.
kexec -e
